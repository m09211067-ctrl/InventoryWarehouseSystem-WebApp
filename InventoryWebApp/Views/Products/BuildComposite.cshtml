@model InventoryWebApp.Models.Product

@{
    ViewData["Title"] = "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬ Ù…Ø±ÙƒØ¨";
}

<div class="container mt-4" dir="rtl">
    <h2 class="text-center mb-4">ğŸ§© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬ Ù…Ø±ÙƒØ¨ (BOM)</h2>

    <form asp-action="SaveComposite" method="post">

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
        <div class="card mb-3">
            <div class="card-header">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
            <div class="card-body">
                <div class="mb-2">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <input type="text"
                           name="productName"
                           class="form-control"
                           value="@Model.ProductName"
                           required />
                </div>

                <div class="mb-2">
                    <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªÙØ¬Ø©</label>
                    <input type="number"
                           name="finalQuantity"
                           class="form-control"
                           value="1"
                           min="1"
                           required />
                </div>
            </div>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø®Ø²Ù† -->
        <div class="card mb-3">
            <div class="card-header">ğŸ¬ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø®Ø²Ù†</div>
            <div class="card-body">
                <select name="warehouseId" class="form-control" required>
                    <option value="">-- Ø§Ø®ØªØ± Ù…Ø®Ø²Ù† --</option>
                    @foreach (var w in ViewBag.Warehouses)
                    {
                        <option value="@w.WarehouseID">
                            @w.WarehouseName (@w.BranchName)
                        </option>
                    }
                </select>
            </div>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª -->
        <div class="card mb-3">
            <div class="card-header">ğŸ§± Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</div>
            <div class="card-body">

                @foreach (var c in ViewBag.Components)
                {
                    <div class="row mb-2 align-items-center">
                        <div class="col-6">
                            <input type="checkbox"
                                   name="componentIds"
                                   value="@c.ProductID"
                                   onchange="toggleQty(this)" />

                            @c.ProductName (Ù…ØªÙˆÙØ±: @c.Quantity)
                        </div>

                        <div class="col-6">
                            <input type="number"
                                   name="componentQuantities[@c.ProductID]"
                                   class="form-control"
                                   placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©"
                                   min="1"
                                   disabled />
                        </div>
                    </div>
                }

            </div>
        </div>

        <button type="submit" class="btn btn-success">
            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø±ÙƒØ¨
        </button>

        <a asp-action="Index" class="btn btn-secondary ms-2">Ø¥Ù„ØºØ§Ø¡</a>
    </form>
</div>

<script>
    function toggleQty(checkbox) {
        const qtyInput = checkbox
            .closest('.row')
            .querySelector('input[type="number"]');

        qtyInput.disabled = !checkbox.checked;

        if (checkbox.checked) {
            qtyInput.required = true;
        } else {
            qtyInput.required = false;
            qtyInput.value = '';
        }
    }
</script>
